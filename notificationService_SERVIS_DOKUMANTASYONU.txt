================================================================================
NOTIFICATION SERVICE SERVİSİ - CLASS VE METOD DOKÜMANTASYONU
================================================================================

Bu servis, bildirim gönderme (email, SMS, push) ve bilet PDF oluşturma işlemlerini yapar.

--------------------------------------------------------------------------------
1. NotificationServiceApplication
--------------------------------------------------------------------------------
AÇIKLAMA: Spring Boot uygulamasının ana başlangıç sınıfıdır.
İŞLEVİ: 
  - Uygulamayı başlatır
  - Feign Client desteğini aktif eder (Order Service'e çağrı için)

METODLAR:
  - main(String[] args): Uygulamayı başlatır

NOTLAR:
  - Port: 8089
  - @EnableFeignClients: Feign Client kullanımını aktif eder

--------------------------------------------------------------------------------
2. NotificationController
--------------------------------------------------------------------------------
AÇIKLAMA: Notification ile ilgili HTTP endpoint'lerini sağlar.

METODLAR:
  - send(SendNotificationRequest request): 
      * Bildirim gönderir (POST /api/notifications)
      * Template kullanarak bildirim oluşturur
      * Email gönderir (eğer mailSender yapılandırılmışsa)
  
  - getByRecipient(String recipient): 
      * Alıcıya göre bildirimleri getirir (GET /api/notifications/recipient/{recipient})

--------------------------------------------------------------------------------
3. NotificationService (Interface)
--------------------------------------------------------------------------------
AÇIKLAMA: Notification işlemleri için servis arayüzü

METODLAR:
  - sendNotification(SendNotificationRequest request): Bildirim gönderme
  - getNotificationsForRecipient(String recipient): Alıcıya göre bildirimleri getirme

--------------------------------------------------------------------------------
4. NotificationServiceImpl
--------------------------------------------------------------------------------
AÇIKLAMA: NotificationService implementasyonu

METODLAR:
  - sendNotification(SendNotificationRequest request): 
      * Template koduna göre NotificationTemplate bulur
      * Template'teki placeholder'ları (örn: {orderId}) request parametreleri ile doldurur
      * Notification entity'si oluşturur ve kaydeder
      * JavaMailSender ile email gönderir (eğer yapılandırılmışsa)
      * Başarılı olursa status'ü SENT yapar
      * Başarısız olursa status'ü FAILED yapar ve retryCount'u artırır
  
  - getNotificationsForRecipient(String recipient): 
      * Alıcıya göre bildirimleri getirir
  
  - applyParams(String template, Map<String, Object> params): 
      * Template string'indeki placeholder'ları (örn: {orderId}) parametrelerle değiştirir
      * Örnek: "Sipariş {orderId} tamamlandı" → "Sipariş 123 tamamlandı"

--------------------------------------------------------------------------------
5. TicketPdfService (Interface)
--------------------------------------------------------------------------------
AÇIKLAMA: Bilet PDF oluşturma servisi arayüzü

METODLAR:
  - generateTicketPdf(OrderClient.OrderResponse order): 
      * Sipariş bilgilerinden PDF oluşturur
      * Geçici dosya olarak kaydeder

--------------------------------------------------------------------------------
6. TicketPdfServiceImpl
--------------------------------------------------------------------------------
AÇIKLAMA: TicketPdfService implementasyonu
NOT: Şu anda basit bir text dosyası oluşturur, gerçek PDF değil

METODLAR:
  - generateTicketPdf(OrderClient.OrderResponse order): 
      * Geçici bir dosya oluşturur
      * Sipariş bilgilerini text formatında yazar:
        - Sipariş numarası
        - Durum
        - Toplam tutar
        - Bilet sayısı
        - Her bilet için: Bilet ID, Etkinlik ID, Fiyat
        - Oluşturulma tarihi
      * Dosyayı döner

NOTLAR:
  - Şu anda gerçek PDF oluşturmuyor, text dosyası oluşturuyor
  - İleride iText veya Apache PDFBox kullanılabilir

--------------------------------------------------------------------------------
7. OrderCompletedHandlerService (Interface)
--------------------------------------------------------------------------------
AÇIKLAMA: ORDER_COMPLETED event'ini işleyen servis arayüzü

METODLAR:
  - handleOrderCompleted(String orderId, String userId, String paymentId): 
      * Sipariş tamamlandığında çağrılır
      * PDF oluşturur ve email gönderir

--------------------------------------------------------------------------------
8. OrderCompletedHandlerServiceImpl
--------------------------------------------------------------------------------
AÇIKLAMA: OrderCompletedHandlerService implementasyonu

METODLAR:
  - handleOrderCompleted(String orderId, String userId, String paymentId): 
      * Order Service'ten sipariş bilgilerini alır (OrderClient)
      * TicketPdfService ile PDF oluşturur
      * Email gönderir (sendTicketEmail)
      * PDF dosyasını temizler
  
  - sendTicketEmail(String userId, String orderId, File pdfFile): 
      * MimeMessage oluşturur
      * Email içeriği hazırlar
      * PDF'i attachment olarak ekler
      * Email gönderir
      * TODO: User Service'ten gerçek email adresini almalı (şu anda placeholder)

--------------------------------------------------------------------------------
9. OrderCompletedConsumer
--------------------------------------------------------------------------------
AÇIKLAMA: Kafka'dan ORDER_COMPLETED event'ini dinleyen consumer
İŞLEVİ: Sipariş tamamlandığında bildirim gönderir

METODLAR:
  - consumeOrderCompleted(String message): 
      * Kafka topic: "order-events"
      * Group ID: "notification-service-group"
      * ORDER_COMPLETED event'ini dinler
      * OrderCompletedHandlerService.handleOrderCompleted() çağırır

RECORD'LAR:
  - OrderCompletedEvent: Sipariş tamamlanma event'i (eventType, orderId, userId, paymentId)

--------------------------------------------------------------------------------
10. Notification (Entity)
--------------------------------------------------------------------------------
AÇIKLAMA: Bildirim veritabanı entity'si

ALANLAR:
  - id: Bildirim ID'si (UUID)
  - recipient: Alıcı (email adresi veya telefon numarası)
  - type: Bildirim tipi (EMAIL, SMS, PUSH_NOTIFICATION)
  - subject: Konu
  - content: İçerik (TEXT)
  - relatedEntityId: İlişkili entity ID'si (örn: orderId)
  - status: Bildirim durumu (PENDING, SENT, FAILED)
  - errorMessage: Hata mesajı
  - retryCount: Tekrar deneme sayısı
  - createdAt: Oluşturulma tarihi
  - sentAt: Gönderilme tarihi

INDEX'LER:
  - idx_recipient: recipient üzerinde index
  - idx_status: status üzerinde index

--------------------------------------------------------------------------------
11. NotificationTemplate (Entity)
--------------------------------------------------------------------------------
AÇIKLAMA: Bildirim şablonu veritabanı entity'si
İŞLEVİ: Bildirim içeriklerini template olarak saklar

ALANLAR:
  - id: Template ID'si
  - templateCode: Template kodu (unique, örn: "ORDER_COMPLETED")
  - subjectTemplate: Konu şablonu (örn: "Sipariş {orderId} tamamlandı")
  - bodyTemplate: İçerik şablonu (TEXT, örn: "Merhaba {userName}, siparişiniz hazır...")
  - isActive: Aktif mi?

NOTLAR:
  - Template'lerde placeholder kullanılır: {orderId}, {userName}, vb.
  - NotificationServiceImpl.applyParams() metodu bu placeholder'ları doldurur

--------------------------------------------------------------------------------
12. NotificationRepository
--------------------------------------------------------------------------------
AÇIKLAMA: Notification entity'si için JPA Repository

METODLAR:
  - findByRecipient(String recipient): Alıcıya göre bildirimleri bulur
  - findByStatus(NotificationStatus status): Duruma göre bildirimleri bulur

--------------------------------------------------------------------------------
13. NotificationTemplateRepository
--------------------------------------------------------------------------------
AÇIKLAMA: NotificationTemplate entity'si için JPA Repository

METODLAR:
  - findByTemplateCodeAndIsActiveTrue(String templateCode): 
      * Template koduna ve aktif durumuna göre template bulur

--------------------------------------------------------------------------------
14. NotificationStatus (Enum)
--------------------------------------------------------------------------------
AÇIKLAMA: Bildirim durumları

DEĞERLER:
  - PENDING: Beklemede
  - SENT: Gönderildi
  - FAILED: Başarısız

--------------------------------------------------------------------------------
15. NotificationType (Enum)
--------------------------------------------------------------------------------
AÇIKLAMA: Bildirim tipleri

DEĞERLER:
  - EMAIL: Email bildirimi
  - SMS: SMS bildirimi
  - PUSH_NOTIFICATION: Push bildirimi

NOTLAR:
  - Şu anda sadece EMAIL implement edilmiş
  - SMS ve PUSH_NOTIFICATION için ileride implementasyon yapılabilir

--------------------------------------------------------------------------------
16. OrderClient
--------------------------------------------------------------------------------
AÇIKLAMA: Order Service'e Feign Client ile çağrı yapan interface

METODLAR:
  - getOrderById(String orderId): Sipariş bilgilerini getirir

RECORD'LAR:
  - OrderResponse: Sipariş yanıtı (id, userId, status, totalAmount, currency, items)
  - OrderItemDto: Sipariş kalemi (ticketId, eventId, price)

================================================================================
